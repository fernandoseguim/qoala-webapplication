@using Website.Models.ViewModels
@model PostViewModel
@{
    Layout = "~/Views/Shared/_LayoutLogged.cshtml";
    ViewBag.Title = "Blog";
    int idPost = (int) HttpContext.Current.Request.Params.Get("idPost").AsDecimal();
}

<h3>Detalhes do Post #@Model.IdPost <button type="button" class="btn btn-default">@Html.ActionLink("Voltar para Lista", "Index")</button></h3>

<div id="actions">
    <ul>
        @if (Model.PublishedAt.IsEmpty())
        {
            using (Html.BeginForm("Publish", "Post",  new { idPost = Model.IdPost}, FormMethod.Post, new { id = "publishForm", idPost = Model.IdPost }))
            {
                <li><a href="javascript:document.getElementById('publishForm').submit()">Publicar Post</a></li>
            }
        }
        <li>@Html.ActionLink("Editar Post", "Edit", new { idPost = Model.IdPost })</li>
        @using (Html.BeginForm("Delete", "Post", new { idPost = Model.IdPost }, FormMethod.Post, new { id = "deleteForm" }))
        {
            <li><a href="javascript:document.getElementById('deleteForm').submit()">Deletar Post</a></li>
        }
    </ul>
</div>

<dl class="dl-horizontal">
    <dt>
        @Html.DisplayNameFor(model => model.Title)
    </dt>

    <dd>
        @Html.DisplayFor(model => model.Title)
    </dd>

    <dt>
        @Html.DisplayNameFor(model => model.PublishedAt)
    </dt>

    <dd>
        @Html.DisplayFor(model => model.PublishedAt)
    </dd>

    <dt>
        @Html.DisplayNameFor(model => model.Content)
    </dt>

    <dd>
        @Html.Raw(Html.DisplayFor(model => model.Content))
    </dd>
</dl>

<hr />
<h4>Comentários</h4>

@if(Model.Comments.Count == 0)
{
    <strong>Não existem comentários aprovados neste post.</strong>
}
else
{
    <dl class="dl-horizontal">
        @foreach (var comment in Model.Comments)
        {
            <dt>
                @Html.DisplayNameFor(model => model.IdUser)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.IdUser)
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.Content)
            </dt>

            <dd>
                @Html.DisplayFor(model => model.Content)
            </dd>

            <dt>
                @Html.RouteLink(
                    "Editar comentário",
                    new {
                        controller = "Comment",
                        action = "Edit",
                        idPost = comment.IdPost,
                        idComment = comment.IdComment,
                        returnUrl = "/post/show?idPost=" + comment.IdPost
                    }
                )
            </dt>
            <hr />
        }
    </dl>
}
